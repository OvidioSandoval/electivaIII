<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Menú con Escáner QR</title>
        <link rel="stylesheet" href="styleMenu.css">
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
            rel="stylesheet">
    </head>
    <body>

        <h1>MENÚ</h1>

   
        <div class="qrcode-container">
            <h2>Comparte este menú</h2>
            <img src="qr.png" alt="Código QR del menú">
            <p>Escanea este código con tu móvil para ver el menú</p>
        </div>

        <script
            src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

        <script>
    const openButton = document.getElementById("open-qr-reader");
    const resultDiv = document.getElementById("qr-reader-results");
    let scanning = false;

    // Si no existe el botón, salimos del script sin hacer nada
    if (!openButton) {
        console.error("Botón 'Escanear QR' no encontrado.");
    } else {
        openButton.addEventListener("click", function () {
            if (scanning) return;

            document.getElementById("qr-reader").style.display = "block";
            resultDiv.innerHTML = "Accediendo a la cámara...";

            Html5Qrcode.getCameras()
                .then(cameras => {
                    if (cameras.length === 0) {
                        resultDiv.innerHTML = "❌ No se encontró ninguna cámara.";
                        return;
                    }

                    const cameraId = cameras[0].id;
                    const html5QrCode = new Html5Qrcode("qr-reader");

                    scanning = true;

                    html5QrCode.start(
                        cameraId,
                        {
                            fps: 10,
                            qrbox: { width: 250, height: 250 }
                        },
                        (decodedText) => {
                            resultDiv.innerHTML = `
                                ✅ QR escaneado:<br>
                                <a href="${decodedText}" target="_blank" style="color:#d32f2f;">
                                    ${decodedText}
                                </a>
                            `;
                            html5QrCode.stop().then(() => {
                                scanning = false;
                            }).catch(err => {
                                console.error("Error al detener:", err);
                            });

                            setTimeout(() => {
                                window.location.href = decodedText;
                            }, 1500);
                        },
                        (err) => {
                            // Ignorar errores temporales
                        }
                    ).catch(err => {
                        resultDiv.innerHTML = `❌ Error al iniciar cámara: ${err}`;
                        scanning = false;
                    });
                })
                .catch(err => {
                    resultDiv.innerHTML = `❌ Error al acceder a cámaras: ${err}`;
                });
        });
    }
</script>
    </body>
</html>